---
import Layout from '../layouts/Layout.astro';
import { MemorialForm } from '../components/memorial/MemorialForm';
import { ImageUploader } from '../components/memorial/ImageUploader';
---

<Layout title="Create a Memorial">
  <div class="max-w-4xl mx-auto px-4 py-12">
    <div class="bg-gray-50/60 rounded-2xl shadow-md p-8 border border-gray-100/50">
      <div class="text-center mb-8">
        <h1 class="text-4xl font-bold text-gray-900 mb-4">Create a Memorial</h1>
        <p class="text-xl text-gray-600">Honor your beloved friend with a beautiful tribute</p>
      </div>
      
      <div class="max-w-2xl mx-auto">
        <div class="mb-8">
          <div class="bg-white rounded-xl p-6 border border-primary-100">
            <h2 class="text-2xl font-semibold text-primary-600 mb-4">Profile Photo</h2>
            <div class="flex flex-col items-center justify-center w-full">
              <div class="relative mb-4">
                <ImageUploader client:load />
              </div>
              <p class="text-sm text-gray-500 text-center mt-4">
                Add a beautiful photo of your beloved pet
              </p>
            </div>
          </div>
        </div>

        <div class="space-y-6">
          <div class="form-group">
            <label class="block text-gray-600 mb-2">Pet Type</label>
            <div class="relative">
              <input 
                type="text" 
                id="petTypeSearch"
                placeholder="Search pet type..."
                class="w-full px-4 py-3 rounded-xl border border-gray-200 focus:border-primary-300 focus:ring-1 focus:ring-primary-200 transition-colors text-gray-600"
              />
              <div id="petTypeDropdown" class="hidden absolute z-10 w-full mt-1 max-h-48 overflow-y-auto bg-white border border-gray-100 rounded-xl shadow-lg">
                <div class="p-2 space-y-1">
                  {/* Common Pet Types */}
                  <button class="w-full px-3 py-2 text-left hover:bg-primary-50 rounded-lg flex items-center gap-2">
                    <span>ğŸ•</span> Dog
                  </button>
                  <button class="w-full px-3 py-2 text-left hover:bg-primary-50 rounded-lg flex items-center gap-2">
                    <span>ğŸ±</span> Cat
                  </button>
                  <button class="w-full px-3 py-2 text-left hover:bg-primary-50 rounded-lg flex items-center gap-2">
                    <span>ğŸ¦</span> Bird
                  </button>
                  <button class="w-full px-3 py-2 text-left hover:bg-primary-50 rounded-lg flex items-center gap-2">
                    <span>ğŸŸ</span> Fish
                  </button>
                  <button class="w-full px-3 py-2 text-left hover:bg-primary-50 rounded-lg flex items-center gap-2">
                    <span>ğŸ‡</span> Rabbit
                  </button>
                  <button class="w-full px-3 py-2 text-left hover:bg-primary-50 rounded-lg flex items-center gap-2">
                    <span>ğŸ¹</span> Hamster
                  </button>
                  <button class="w-full px-3 py-2 text-left hover:bg-primary-50 rounded-lg flex items-center gap-2">
                    <span>ğŸ </span> Parrot
                  </button>
                  <button class="w-full px-3 py-2 text-left hover:bg-primary-50 rounded-lg flex items-center gap-2">
                    <span>ğŸ¢</span> Turtle
                  </button>
                  <button class="w-full px-3 py-2 text-left hover:bg-primary-50 rounded-lg flex items-center gap-2">
                    <span>ğŸ´</span> Lizard
                  </button>
                  <button class="w-full px-3 py-2 text-left hover:bg-primary-50 rounded-lg flex items-center gap-2">
                    <span>ğŸ</span> Snake
                  </button>
                  <button class="w-full px-3 py-2 text-left hover:bg-primary-50 rounded-lg flex items-center gap-2">
                    <span>ğŸ€</span> Rat
                  </button>
                  <button class="w-full px-3 py-2 text-left hover:bg-primary-50 rounded-lg flex items-center gap-2">
                    <span>ğŸ</span> Mouse
                  </button>
                  <button class="w-full px-3 py-2 text-left hover:bg-primary-50 rounded-lg flex items-center gap-2">
                    <span>ğŸ´</span> Horse
                  </button>
                  <button class="w-full px-3 py-2 text-left hover:bg-primary-50 rounded-lg flex items-center gap-2">
                    <span>ğŸ¦„</span> Hedgehog
                  </button>
                  <button class="w-full px-3 py-2 text-left hover:bg-primary-50 rounded-lg flex items-center gap-2">
                    <span>ğŸ·</span> Pig
                  </button>
                  <button class="w-full px-3 py-2 text-left hover:bg-primary-50 rounded-lg flex items-center gap-2">
                    <span>ğŸ–</span> Duck
                  </button>
                  <button class="w-full px-3 py-2 text-left hover:bg-primary-50 rounded-lg flex items-center gap-2">
                    <span>ğŸ“</span> Chicken
                  </button>
                  <button class="w-full px-3 py-2 text-left hover:bg-primary-50 rounded-lg flex items-center gap-2">
                    <span>ğŸ¦©</span> Flamingo
                  </button>
                  <button class="w-full px-3 py-2 text-left hover:bg-primary-50 rounded-lg flex items-center gap-2">
                    <span>ğŸ¦œ</span> Macaw
                  </button>
                  <button class="w-full px-3 py-2 text-left hover:bg-primary-50 rounded-lg flex items-center gap-2">
                    <span>ğŸ¦š</span> Peacock
                  </button>
                </div>
              </div>
            </div>
          </div>

          <div class="form-group">
            <label class="block text-gray-600 mb-2">Pet's Name</label>
            <input 
              type="text" 
              placeholder="Enter your pet's name"
              class="w-full px-4 py-3 rounded-xl border border-gray-200 focus:border-primary-300 focus:ring-1 focus:ring-primary-200 transition-colors text-gray-600"
            />
          </div>

          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">
              Bio
            </label>
            <div class="relative">
              <textarea 
                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500 resize-none"
                rows="4"
                placeholder="Share your pet's story..."
                maxlength="500"
              ></textarea>
              <div class="absolute bottom-2 right-2 text-xs text-gray-500">
                <span id="charCount">0</span>/500
              </div>
            </div>
            <p class="mt-2 text-sm text-gray-500">
              Tell us about your pet's personality, favorite activities, and what made them special.
            </p>
          </div>

          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">
                Birth Date
              </label>
              <input 
                type="date"
                min="1900-01-01"
                max={new Date().toISOString().split('T')[0]}
                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500"
                required
              />
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">
                Rainbow Bridge Date
              </label>
              <input 
                type="date"
                max={new Date().toISOString().split('T')[0]}
                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500"
                required
              />
            </div>
          </div>

          <div class="pt-6">
            <button 
              class="w-full px-6 py-3 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors"
            >
              Create Memorial
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</Layout>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const imageInput = document.getElementById('imageInput');
    const preview = document.getElementById('preview');
    const cropControls = document.getElementById('cropControls');
    let rotation = 0;

    imageInput.addEventListener('change', (e) => {
      const file = e.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = (e) => {
          preview.src = e.target.result;
          preview.classList.remove('hidden');
          cropControls.classList.remove('hidden');
        };
        reader.readAsDataURL(file);
      }
    });

    document.getElementById('rotateLeft').addEventListener('click', () => {
      rotation = (rotation - 90) % 360;
      preview.style.transform = `rotate(${rotation}deg)`;
    });

    document.getElementById('rotateRight').addEventListener('click', () => {
      rotation = (rotation + 90) % 360;
      preview.style.transform = `rotate(${rotation}deg)`;
    });

    document.getElementById('cropButton').addEventListener('click', () => {
      console.log('Crop requested with rotation:', rotation);
    });
  });

  document.addEventListener('DOMContentLoaded', () => {
    const textarea = document.querySelector('textarea');
    const charCount = document.getElementById('charCount');

    if (textarea && charCount) {
      textarea.addEventListener('input', () => {
        const count = textarea.value.length;
        charCount.textContent = count.toString();
        
        if (count >= 450) {
          charCount.classList.add('text-yellow-600');
        } else if (count >= 500) {
          charCount.classList.add('text-red-600');
        } else {
          charCount.classList.remove('text-yellow-600', 'text-red-600');
        }
      });
    }
  });

  document.addEventListener('DOMContentLoaded', () => {
    const searchInput = document.getElementById('petTypeSearch');
    const dropdown = document.getElementById('petTypeDropdown');
    const options = dropdown.querySelectorAll('button');

    // Show dropdown on input focus
    searchInput.addEventListener('focus', () => {
      dropdown.classList.remove('hidden');
    });

    // Filter options as user types
    searchInput.addEventListener('input', (e) => {
      const searchText = e.target.value.toLowerCase();
      options.forEach(option => {
        const text = option.textContent.toLowerCase();
        if (text.includes(searchText)) {
          option.style.display = 'flex';
        } else {
          option.style.display = 'none';
        }
      });
    });

    // Handle option selection
    options.forEach(option => {
      option.addEventListener('click', () => {
        searchInput.value = option.textContent.trim();
        dropdown.classList.add('hidden');
      });
    });

    // Close dropdown when clicking outside
    document.addEventListener('click', (e) => {
      if (!searchInput.contains(e.target) && !dropdown.contains(e.target)) {
        dropdown.classList.add('hidden');
      }
    });
  });
</script>

<style>
  .image-preview {
    width: 150px;
    height: 150px;
    margin: 0 auto 1rem;
    position: relative;
  }

  .image-container {
    width: 100%;
    height: 100%;
    position: relative;
    overflow: hidden;
    border-radius: 50%;
    border: 2px dashed #e5e7eb;
  }

  .image-preview img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.3s ease;
  }

  .upload-placeholder {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    background: #f9fafb;
    border-radius: 50%;
  }

  #preview:not(.hidden) + #placeholder {
    display: none;
  }
</style>